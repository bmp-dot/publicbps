{"status":{},"contains_secrets":false,"product_version":"3.2.2","spec":{"description":"","resources":{"endpoints_information":[],"endpoint_definition_list":[],"client_attrs":{},"credential_definition_list":[{"username":"admin","description":"","type":"PASSWORD","secret":{"attrs":{"is_secret_modified":false,"secret_reference":{}}},"name":"Prism Central User"}],"runbook":{"task_definition_list":[{"retries":"0","description":"","child_tasks_local_reference_list":[{"kind":"app_task","name":"RunNumber"}],"name":"6a86192a_dag","attrs":{"edges":[],"type":""},"timeout_secs":"0","type":"DAG","variable_list":[]},{"retries":"0","description":"","child_tasks_local_reference_list":[{"kind":"app_task","name":"d6bd6dac_1_META"}],"name":"RunNumber","attrs":{"loop_variable":"iteration","exit_condition_type":"dont_care","type":"","iterations":"@@{deploynum}@@"},"timeout_secs":"0","type":"WHILE_LOOP","variable_list":[]},{"retries":"0","description":"","child_tasks_local_reference_list":[{"kind":"app_task","name":"API to Calm BP"},{"kind":"app_task","name":"Delay"}],"name":"d6bd6dac_1_META","attrs":{"type":""},"timeout_secs":"0","type":"META","variable_list":[]},{"retries":"0","description":"","child_tasks_local_reference_list":[],"name":"API to Calm BP","attrs":{"script":"user = \"@@{Prism Central User.username}@@\"\npassword = \"@@{Prism Central User.secret}@@\"\n\n\nprint \"Iteration: @@{iteration}@@\"\n\ndef process_request(url, method, user, password, headers, payload=None):\n    r = urlreq(url, verb=method, auth=\"BASIC\", user=user, passwd=password, params=payload, verify=False, headers=headers)\n    return r\n    \n\npayload = None\n\nurl = \"https:\/\/@@{pc_instance_ip}@@:9440\/api\/nutanix\/v3\/blueprints\/@@{bplist}@@\"\nheaders = {'Accept': 'application\/json', 'Content-Type': 'application\/json'}\nurl_method = \"GET\"\n\nr = process_request(url, url_method, user, password, headers, payload)\nprint \"Response Status: \" + str(r.status_code)\n\nbp_index = 0\nvar_index = 0\nblueprint_json = r.json()\ndel blueprint_json['status']\ndel blueprint_json['spec']['name']\nblueprint_json['spec']['application_name'] = \"@@{OS}@@-@@{calm_random}@@\"\nblueprint_json['spec']['app_profile_reference'] = {\"kind\": \"app_profile\", \"uuid\": \"@@{applist}@@\" }\nblueprint_json['metadata']['owner_reference'] = {\"kind\": \"user\", \"uuid\": \"00000000-0000-0000-0000-000000000000\", \"name\": \"admin\"}\nfor profileKey in blueprint_json['spec']['resources']['app_profile_list']:\n    print(\"Profile: \" + str(profileKey))\n    bp_index += 1\n\nprint \"blueprint_spec: \" + str(blueprint_json)\n\nheaders = {'Accept': 'application\/json', 'Content-Type': 'application\/json'}\nurl = url + \"\/launch\"\nurl_method = \"POST\"\npayload = json.dumps(blueprint_json)\n\nr = process_request(url, url_method, user, password, headers, payload)\nprint \"Response Status: \" + str(r.status_code)\nprint \"Response: \", r.json()","type":"","command_line_args":"","exit_status":[],"script_type":"static"},"timeout_secs":"0","type":"EXEC","variable_list":[]},{"retries":"0","description":"","child_tasks_local_reference_list":[],"name":"Delay","attrs":{"type":"","interval_secs":30},"timeout_secs":"0","type":"DELAY","variable_list":[]}],"description":"","name":"8673eca4_runbook","main_task_local_reference":{"kind":"app_task","name":"6a86192a_dag"},"variable_list":[{"val_type":"STRING","is_mandatory":false,"description":"","data_type":"BASE","type":"LOCAL","name":"deploynum","value":"4","label":"How Many VMs?","attrs":{"type":""},"editables":{"value":true},"is_hidden":false,"options":{"type":"PREDEFINED","choices":[]}},{"val_type":"STRING","is_mandatory":false,"description":"","data_type":"BASE","type":"LOCAL","name":"OS","value":"CentOS","label":"","attrs":{"type":"LOCAL"},"editables":{"value":true},"is_hidden":false,"options":{"type":"PREDEFINED","choices":["CentOS","Windows"]}},{"val_type":"STRING","is_mandatory":false,"description":"","data_type":"BASE","type":"EXEC_LOCAL","name":"bplist","value":"c4366164-48e7-08a2-98ef-db389756bb79\n","label":"BP UUID","attrs":{"type":""},"editables":{"value":true},"is_hidden":false,"options":{"type":"EXEC","attrs":{"script":"if \"@@{OS}@@\" == \"Windows\":\n        bpuuid = [\"f4f48633-382d-4b82-b681-c0eafed47e49\"]\nelif \"@@{OS}@@\" == \"CentOS\":\n        bpuuid = [\"c4366164-48e7-08a2-98ef-db389756bb79\"]\nelse:\n     bpuuid = [\"invalid environment\"]\n\nprint(', '.join(bpuuid))","type":"EXEC","command_line_args":"","exit_status":[],"script_type":"static"}}},{"val_type":"STRING","is_mandatory":false,"description":"","data_type":"BASE","type":"EXEC_LOCAL","name":"applist","value":"4527b788-40cb-2d34-d141-61cbd9aad7af\n","label":"APP UUID","attrs":{"type":""},"editables":{"value":true},"is_hidden":false,"options":{"type":"EXEC","attrs":{"script":"if \"@@{OS}@@\" == \"Windows\":\n        appuuid = [\"cb5c0b02-8103-44ac-aabc-99e0bfe3ca07\"]\nelif \"@@{OS}@@\" == \"CentOS\":\n        appuuid = [\"4527b788-40cb-2d34-d141-61cbd9aad7af\"]\nelse:\n     appuuid = [\"invalid environment\"]\n\nprint(', '.join(appuuid))","type":"EXEC","command_line_args":"","exit_status":[],"script_type":"static"}}},{"val_type":"STRING","is_mandatory":false,"description":"","data_type":"BASE","type":"LOCAL","name":"pc_instance_ip","value":"10.42.48.39","label":"","attrs":{"type":""},"editables":{"value":false},"is_hidden":false,"options":{"type":"PREDEFINED","choices":[]}}]}},"name":"Multi Launch"},"api_version":"3.0","metadata":{"last_update_time":"1620245777627450","kind":"runbook","spec_version":55,"creation_time":"1619803707403118","name":"Multi Launch"}}
